gtest，英文全称是Google C++ Testing Framework，即谷歌C++测试框架。是从谷歌内部诞生并受到业界追捧的一个非常优秀的测试框架，支持如自动发现测试、自定义断言、死亡测试、自动报告等诸多功能。
本文就来详细介绍gtest的使用。
一、gtest源码下载

http://code.google.com/p/googletest/downloads/list

目前有两个版本的gtest源代码。
二、Linux下安装并使用gtest

1）使用unzip命令解压完后，在linux上通过如下命令执行编译安装


1
2
3
./configure
make
sudo make install
但在执行sudo make install时，会提示类似如下错误：

echo “‘make install’ is dangerous and not supported. Instead, see README for how to integrate Google Test into your build system.” ‘make install’ is dangerous and not supported. Instead, see README for how to integrate Google Test into your build system. false

也就是提醒我们去安装README里面的提示进行安装。
事实上，我们使用make
install，会在机器上安装一份编译好的gtest库，以后测试时只需要链接该库就可以了（linux下的library大多数都采用这种方式）。这样虽然方便，但会带来一个问题：每个人使用gtest时，可能需要不同的编译选项，如果使用别人预先编译好的gtest库，可能会造成混乱。所以每个人在编译自己的测试工程时，需要自己编译自己需要的gtest库。因此现在并不提供make install。
README文档有点长，如果你觉得麻烦，请继续往下看。
三、google C++测试框架gtest使用实例

事实上，将安装包解压后，我们就能看到里面有一个samples的文件夹和make文件夹，而这两个文件夹，给出来如何使用gtest的具体实例。进入make文件夹后，你能看到里面有一个Makefile文件，这个Makefile文件将gtest的具体用法说明的清清楚楚。Makefile具体文件如下：

1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
# A sample Makefile for building Google Test and using it in user
# tests.  Please tweak it to suit your environment and project.  You
# may want to move it to your project's root directory.
#
# SYNOPSIS:
#
#   make [all]  - makes everything.
#   make TARGET - makes the given target.
#   make clean  - removes all files generated by make.
 
# Please tweak the following variable definitions as needed by your
# project, except GTEST_HEADERS, which you can use in your own targets
# but shouldn't modify.
 
# Points to the root of Google Test, relative to where this file is.
# Remember to tweak this if you move this file.
GTEST_DIR = ..
 
# Where to find user code.
USER_DIR = ../samples
 
# Flags passed to the preprocessor.
# Set Google Test's header directory as a system directory, such that
# the compiler doesn't generate warnings in Google Test headers.
CPPFLAGS += -isystem $(GTEST_DIR)/include
 
# Flags passed to the C++ compiler.
CXXFLAGS += -g -Wall -Wextra -pthread
 
# All tests produced by this Makefile.  Remember to add new tests you
# created to the list.
TESTS = sample1_unittest
 
# All Google Test headers.  Usually you shouldn't change this
# definition.
GTEST_HEADERS = $(GTEST_DIR)/include/gtest/*.h \
                                                            $(GTEST_DIR)/include/gtest/internal/*.h
                                                             
# House-keeping build targets.
 
all : $(TESTS)
 
clean :
    rm -f $(TESTS) gtest.a gtest_main.a *.o
     
# Builds gtest.a and gtest_main.a.
 
# Usually you shouldn't tweak such internal variables, indicated by a
# trailing _.
GTEST_SRCS_ = $(GTEST_DIR)/src/*.cc $(GTEST_DIR)/src/*.h $(GTEST_HEADERS)
 
# For simplicity and to avoid depending on Google Test's
# implementation details, the dependencies specified below are
# conservative and not optimized.  This is fine as Google Test
# compiles fast and for ordinary users its source rarely changes.
gtest-all.o : $(GTEST_SRCS_)
    $(CXX) $(CPPFLAGS) -I$(GTEST_DIR) $(CXXFLAGS) -c \
                $(GTEST_DIR)/src/gtest-all.cc
                 
                gtest_main.o : $(GTEST_SRCS_)
                    $(CXX) $(CPPFLAGS) -I$(GTEST_DIR) $(CXXFLAGS) -c \
                                $(GTEST_DIR)/src/gtest_main.cc
                                 
                                gtest.a : gtest-all.o
                                    $(AR) $(ARFLAGS) $@ $^
                                     
                                    gtest_main.a : gtest-all.o gtest_main.o
                                        $(AR) $(ARFLAGS) $@ $^
                                         
# Builds a sample test.  A test should link with either gtest.a or
# gtest_main.a, depending on whether it defines its own main()
# function.
 
sample1.o : $(USER_DIR)/sample1.cc $(USER_DIR)/sample1.h $(GTEST_HEADERS)
    $(CXX) $(CPPFLAGS) $(CXXFLAGS) -c $(USER_DIR)/sample1.cc
     
    sample1_unittest.o : $(USER_DIR)/sample1_unittest.cc \
                         $(USER_DIR)/sample1.h $(GTEST_HEADERS)
                             $(CXX) $(CPPFLAGS) $(CXXFLAGS) -c $(USER_DIR)/sample1_unittest.cc
                              
                             sample1_unittest : sample1.o sample1_unittest.o gtest_main.a
                                 $(CXX) $(CPPFLAGS) $(CXXFLAGS) -lpthread $^ -o $@
                                 这个Makefile是samplies文件夹下源代码的自动化编译脚本。因此，我们需要做的事情是执行如下命令：首先切换到make目录下，然后执行make命令。

                                 1
                                 2
                                 Code123.cc$ cd make
                                 Code123.cc$ make
                                 执行完后，就会自动编译出单元测试可执行程序sample1_unittest。
                                 gtest官方给出的示例程序的运行结果如下：

                                 1
                                 2
                                 3
                                 4
                                 5
                                 6
                                 7
                                 8
                                 9
                                 10
                                 11
                                 12
                                 13
                                 14
                                 15
                                 16
                                 17
                                 18
                                 19
                                 20
                                 21
                                 22
                                 23
                                 24
                                 25
                                 26
                                 27
                                 Code123.cc$ls
                                 gtest-all.o  gtest_main.a  gtest_main.o  Makefile  sample1.o  sample1_unittest  sample1_unittest.o
              Code123.cc$./sample1_unittest 
              Running main() from gtest_main.cc
              [==========] Running 6 tests from 2 test cases.
              [----------] Global test environment set-up.
              [----------] 3 tests from FactorialTest
              [ RUN      ] FactorialTest.Negative
              [       OK ] FactorialTest.Negative (0 ms)
    [ RUN      ] FactorialTest.Zero
    [       OK ] FactorialTest.Zero (0 ms)
    [ RUN      ] FactorialTest.Positive
    [       OK ] FactorialTest.Positive (0 ms)
    [----------] 3 tests from FactorialTest (1 ms total)
     
    [----------] 3 tests from IsPrimeTest
    [ RUN      ] IsPrimeTest.Negative
    [       OK ] IsPrimeTest.Negative (0 ms)
    [ RUN      ] IsPrimeTest.Trivial
    [       OK ] IsPrimeTest.Trivial (0 ms)
    [ RUN      ] IsPrimeTest.Positive
    [       OK ] IsPrimeTest.Positive (0 ms)
    [----------] 3 tests from IsPrimeTest (0 ms total)
     
    [----------] Global test environment tear-down
    [==========] 6 tests from 2 test cases ran. (2 ms total)
    [  PASSED  ] 6 tests.
     四、如何使用gtest对自己的程序进行单元测试？
     有了第三步的样例，我们只需要仿照samples文件夹中的样例，编写我们自己的单元测试用例便可。(注意第三步中Makefile文件与你要测试的源文件没在同一个文件夹下，如果你的源代码存放位置有变化，请修改如下语句中USER_DIR的值。

     1
     2
# Where to find user code.
     USER_DIR = ../samples
     总结：从上面的使用可以看出，我们使用谷歌C++单元测试框架gtest时，并不需要预先编译gtest框架，只需要在测试代码中通过引用gtest源文件来使用gtest进行单元测试。
